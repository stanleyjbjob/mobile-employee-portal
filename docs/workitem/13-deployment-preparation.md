# å·¥ä½œé …ç›® 13 - éƒ¨ç½²æº–å‚™èˆ‡ä¸Šç·š

## ğŸ“‹ åŸºæœ¬è³‡è¨Š
- **å·¥ä½œé …ç›®ç·¨è™Ÿ**: WI-013
- **å„ªå…ˆç´š**: é«˜
- **é ä¼°å·¥ä½œé‡**: 3-4 å¤©
- **è² è²¬äººå“¡**: DevOps å·¥ç¨‹å¸« + ç³»çµ±ç®¡ç†å“¡
- **å‰ç½®æ¢ä»¶**: WI-012 (æ•ˆèƒ½å„ªåŒ–å®Œæˆ)
- **éšæ®µ**: ç¬¬ä¸‰éšæ®µ (Month 9)

## ğŸ¯ å·¥ä½œç›®æ¨™
å®Œæˆç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æº–å‚™ï¼Œå»ºç«‹ CI/CD æµç¨‹ï¼Œç¢ºä¿ç³»çµ±èƒ½å¤ ç©©å®šä¸”å®‰å…¨åœ°åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­é‹è¡Œã€‚

## ğŸ“ è©³ç´°å·¥ä½œå…§å®¹

### ç”Ÿç”¢ç’°å¢ƒæº–å‚™
- [ ] **ä¼ºæœå™¨ç’°å¢ƒå»ºç½®** - ç”Ÿç”¢ä¼ºæœå™¨é…ç½®å’Œè¨­å®š
- [ ] **è³‡æ–™åº«éƒ¨ç½²** - ç”Ÿç”¢è³‡æ–™åº«å»ºç«‹å’Œåˆå§‹åŒ–
- [ ] **SSL æ†‘è­‰é…ç½®** - HTTPS æ†‘è­‰ç”³è«‹å’Œè¨­å®š
- [ ] **ç¶²åŸŸåç¨±è¨­å®š** - DNS é…ç½®å’Œç¶²åŸŸæŒ‡å‘
- [ ] **è² è¼‰å‡è¡¡å™¨é…ç½®** - é«˜å¯ç”¨æ€§æ¶æ§‹è¨­å®š
- [ ] **CDN é…ç½®** - éœæ…‹è³‡æºåˆ†ç™¼ç¶²è·¯è¨­å®š
- [ ] **ç›£æ§ç³»çµ±éƒ¨ç½²** - ç”Ÿç”¢ç’°å¢ƒç›£æ§å·¥å…·å®‰è£
- [ ] **å‚™ä»½æ©Ÿåˆ¶å»ºç«‹** - è‡ªå‹•å‚™ä»½ç³»çµ±è¨­å®š

### Docker å®¹å™¨åŒ–éƒ¨ç½²
- [ ] **Docker æ˜ åƒæª”å„ªåŒ–** - å¤šéšæ®µå»ºç½®å„ªåŒ–
- [ ] **Docker Compose é…ç½®** - ç”Ÿç”¢ç’°å¢ƒå®¹å™¨ç·¨æ’
- [ ] **å¥åº·æª¢æŸ¥é…ç½®** - å®¹å™¨å¥åº·ç‹€æ…‹ç›£æ§
- [ ] **è³‡æºé™åˆ¶è¨­å®š** - CPU å’Œè¨˜æ†¶é«”ä½¿ç”¨é™åˆ¶
- [ ] **ç¶²è·¯é…ç½®** - å®¹å™¨é–“ç¶²è·¯å®‰å…¨è¨­å®š
- [ ] **æŒä¹…åŒ–å„²å­˜** - è³‡æ–™æŒä¹…åŒ–æ–¹æ¡ˆ
- [ ] **æ˜ åƒæª”å€‰åº«** - ç§æœ‰æ˜ åƒæª”å€‰åº«å»ºç«‹
- [ ] **å®¹å™¨å®‰å…¨æƒæ** - å®‰å…¨æ¼æ´æª¢æ¸¬

### CI/CD æµç¨‹å»ºç«‹
- [ ] **GitHub Actions è¨­å®š** - è‡ªå‹•åŒ–å»ºç½®å’Œéƒ¨ç½²
- [ ] **å»ºç½®æµç¨‹é…ç½®** - ç¨‹å¼ç¢¼ç·¨è­¯å’Œæ¸¬è©¦
- [ ] **æ¸¬è©¦è‡ªå‹•åŒ–** - è‡ªå‹•åŒ–æ¸¬è©¦æ•´åˆ
- [ ] **éƒ¨ç½²æµç¨‹** - è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬
- [ ] **ç’°å¢ƒç®¡ç†** - é–‹ç™¼ã€æ¸¬è©¦ã€ç”Ÿç”¢ç’°å¢ƒç®¡ç†
- [ ] **å›æ»¾æ©Ÿåˆ¶** - éƒ¨ç½²å¤±æ•—è‡ªå‹•å›æ»¾
- [ ] **ç™¼å¸ƒç®¡ç†** - ç‰ˆæœ¬æ§åˆ¶å’Œç™¼å¸ƒå¯©æ ¸
- [ ] **é€šçŸ¥æ©Ÿåˆ¶** - éƒ¨ç½²ç‹€æ…‹é€šçŸ¥

### å®‰å…¨æ€§é…ç½®
- [ ] **é˜²ç«ç‰†è¨­å®š** - ç¶²è·¯å®‰å…¨è¦å‰‡é…ç½®
- [ ] **å­˜å–æ§åˆ¶** - ä¼ºæœå™¨å­˜å–æ¬Šé™ç®¡ç†
- [ ] **æ•æ„Ÿè³‡æ–™ç®¡ç†** - å¯†ç¢¼å’Œ API é‡‘é‘°ç®¡ç†
- [ ] **æ—¥èªŒå®‰å…¨** - æ—¥èªŒå„²å­˜å’Œå­˜å–æ§åˆ¶
- [ ] **æ¼æ´æƒæ** - å®šæœŸå®‰å…¨æ¼æ´æª¢æ¸¬
- [ ] **å…¥ä¾µåµæ¸¬** - ç•°å¸¸è¡Œç‚ºç›£æ§
- [ ] **è³‡æ–™åŠ å¯†** - å‚³è¼¸å’Œå„²å­˜åŠ å¯†
- [ ] **åˆè¦æ€§æª¢æŸ¥** - è³‡å®‰åˆè¦æ€§é©—è­‰

## âœ… å®Œæˆæ¨™æº–
- [ ] ç”Ÿç”¢ç’°å¢ƒæˆåŠŸéƒ¨ç½²ä¸¦æ­£å¸¸é‹è¡Œ
- [ ] CI/CD æµç¨‹å®Œæ•´ä¸”ç©©å®š
- [ ] æ‰€æœ‰å®‰å…¨æªæ–½æ­£ç¢ºé…ç½®
- [ ] ç›£æ§å’Œæ—¥èªŒç³»çµ±æ­£å¸¸é‹ä½œ
- [ ] å‚™ä»½å’Œç½é›£å¾©åŸæ©Ÿåˆ¶å¯ç”¨
- [ ] æ•ˆèƒ½è¡¨ç¾ç¬¦åˆé æœŸ
- [ ] ä½¿ç”¨è€…å¯ä»¥æ­£å¸¸å­˜å–ç³»çµ±
- [ ] æ‰€æœ‰ç’°å¢ƒè®Šæ•¸å’Œé…ç½®æ­£ç¢º
- [ ] ç¶²åŸŸå’Œ SSL æ†‘è­‰æ­£å¸¸
- [ ] è² è¼‰æ¸¬è©¦é€šé

## ğŸ³ Docker å®¹å™¨åŒ–é…ç½®

### å¾Œç«¯ Dockerfile å„ªåŒ–
```dockerfile
# å¤šéšæ®µå»ºç½®
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY ["EmployeePortal.Api.csproj", "."]
RUN dotnet restore "EmployeePortal.Api.csproj"
COPY . .
RUN dotnet build "EmployeePortal.Api.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "EmployeePortal.Api.csproj" -c Release -o /app/publish

# é‹è¡Œéšæ®µ
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS runtime
WORKDIR /app
COPY --from=publish /app/publish .

# å»ºç«‹é root ä½¿ç”¨è€…
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser

# å¥åº·æª¢æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1

EXPOSE 8080
ENTRYPOINT ["dotnet", "EmployeePortal.Api.dll"]
```

### å‰ç«¯ Dockerfile å„ªåŒ–
```dockerfile
# å»ºç½®éšæ®µ
FROM node:18-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build:prod

# é‹è¡Œéšæ®µ
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

# å»ºç«‹é root ä½¿ç”¨è€…
RUN addgroup -g 1001 -S appuser && adduser -S appuser -G appuser
USER appuser

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### Docker Compose ç”Ÿç”¢é…ç½®
```yaml
version: '3.8'

services:
  api:
    image: employee-portal-api:latest
    container_name: employee-portal-api
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ConnectionStrings__DefaultConnection=${DB_CONNECTION_STRING}
      - JWT__Secret=${JWT_SECRET}
    depends_on:
      - db
      - redis
    networks:
      - app-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  web:
    image: employee-portal-web:latest
    container_name: employee-portal-web
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - api
    networks:
      - app-network
    restart: unless-stopped

  db:
    image: postgres:15
    container_name: employee-portal-db
    environment:
      - POSTGRES_DB=${DB_NAME}
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - db_data:/var/lib/postgresql/data
      - ./backup:/backup
    networks:
      - app-network
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: employee-portal-redis
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    networks:
      - app-network
    restart: unless-stopped

volumes:
  db_data:
  redis_data:

networks:
  app-network:
    driver: bridge
```

## ğŸš€ CI/CD GitHub Actions é…ç½®

### å»ºç½®å’Œæ¸¬è©¦æµç¨‹
```yaml
name: Build and Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  backend-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'
    
    - name: Restore dependencies
      run: dotnet restore api/EmployeePortal.Api.csproj
    
    - name: Build
      run: dotnet build api/EmployeePortal.Api.csproj --no-restore
    
    - name: Test
      run: dotnet test api/EmployeePortal.Tests.csproj --no-build --verbosity normal
    
    - name: Code Coverage
      run: |
        dotnet test api/EmployeePortal.Tests.csproj --collect:"XPlat Code Coverage"
        
  frontend-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: admin-portal/package-lock.json
    
    - name: Install dependencies
      run: npm ci
      working-directory: admin-portal
    
    - name: Run tests
      run: npm run test:ci
      working-directory: admin-portal
    
    - name: Build
      run: npm run build:prod
      working-directory: admin-portal
```

### éƒ¨ç½²æµç¨‹
```yaml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Login to Docker Hub
      uses: docker/login-action@v2
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
    
    - name: Build and push Docker images
      run: |
        # å»ºç½®å¾Œç«¯æ˜ åƒæª”
        docker build -t employee-portal-api:${{ github.sha }} api/
        docker tag employee-portal-api:${{ github.sha }} employee-portal-api:latest
        docker push employee-portal-api:${{ github.sha }}
        docker push employee-portal-api:latest
        
        # å»ºç½®å‰ç«¯æ˜ åƒæª”
        docker build -t employee-portal-web:${{ github.sha }} admin-portal/
        docker tag employee-portal-web:${{ github.sha }} employee-portal-web:latest
        docker push employee-portal-web:${{ github.sha }}
        docker push employee-portal-web:latest
    
    - name: Deploy to production
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.PROD_HOST }}
        username: ${{ secrets.PROD_USER }}
        key: ${{ secrets.PROD_SSH_KEY }}
        script: |
          cd /opt/employee-portal
          docker-compose pull
          docker-compose up -d
          docker system prune -f
    
    - name: Health check
      run: |
        sleep 30
        curl -f ${{ secrets.PROD_URL }}/health || exit 1
    
    - name: Notify deployment
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

## ğŸ”§ ç”Ÿç”¢ç’°å¢ƒé…ç½®

### Nginx é…ç½®
```nginx
server {
    listen 80;
    server_name employee-portal.company.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name employee-portal.company.com;
    
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    
    # å®‰å…¨æ¨™é ­
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # å‰ç«¯éœæ…‹æª”æ¡ˆ
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # API åå‘ä»£ç†
    location /api/ {
        proxy_pass http://employee-portal-api:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ™‚è¨­å®š
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
    
    # æª”æ¡ˆä¸Šå‚³å¤§å°é™åˆ¶
    client_max_body_size 10M;
    
    # Gzip å£“ç¸®
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json;
}
```

### ç’°å¢ƒè®Šæ•¸é…ç½®
```bash
# .env.production
# è³‡æ–™åº«è¨­å®š
DB_CONNECTION_STRING=Host=employee-portal-db;Database=EmployeePortal;Username=dbuser;Password=${DB_PASSWORD}
DB_NAME=EmployeePortal
DB_USER=dbuser
DB_PASSWORD=${DB_PASSWORD}

# JWT è¨­å®š
JWT_SECRET=${JWT_SECRET}
JWT_ISSUER=employee-portal.company.com
JWT_AUDIENCE=employee-portal-users

# Redis è¨­å®š
REDIS_CONNECTION_STRING=employee-portal-redis:6379
REDIS_PASSWORD=${REDIS_PASSWORD}

# éƒµä»¶è¨­å®š
SMTP_HOST=smtp.company.com
SMTP_PORT=587
SMTP_USER=${SMTP_USER}
SMTP_PASSWORD=${SMTP_PASSWORD}

# æª”æ¡ˆå„²å­˜è¨­å®š
FILE_UPLOAD_PATH=/app/uploads
MAX_FILE_SIZE=10485760

# ç›£æ§è¨­å®š
APPLICATION_INSIGHTS_CONNECTION_STRING=${AI_CONNECTION_STRING}
```

## ğŸ“Š ç›£æ§å’Œæ—¥èªŒé…ç½®

### å¥åº·æª¢æŸ¥ç«¯é»
```csharp
// HealthCheckExtensions.cs
public static class HealthCheckExtensions
{
    public static IServiceCollection AddHealthChecks(this IServiceCollection services, 
        IConfiguration configuration)
    {
        services.AddHealthChecks()
            .AddNpgSql(configuration.GetConnectionString("DefaultConnection"))
            .AddRedis(configuration.GetConnectionString("Redis"))
            .AddCheck<ApiHealthCheck>("api")
            .AddCheck<FileSystemHealthCheck>("filesystem");
        
        return services;
    }
}

// Program.cs
app.MapHealthChecks("/health", new HealthCheckOptions
{
    ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse
});
```

### æ—¥èªŒé…ç½®
```json
{
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console"
      },
      {
        "Name": "File",
        "Args": {
          "path": "/app/logs/log-.txt",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 30
        }
      },
      {
        "Name": "ApplicationInsights",
        "Args": {
          "connectionString": "${APPLICATION_INSIGHTS_CONNECTION_STRING}"
        }
      }
    ]
  }
}
```

## ğŸ”’ å®‰å…¨é…ç½®æª¢æŸ¥æ¸…å–®

### ä¼ºæœå™¨å®‰å…¨
- [ ] é—œé–‰ä¸å¿…è¦çš„é€£æ¥åŸ 
- [ ] æ›´æ–°ä½œæ¥­ç³»çµ±å’Œè»Ÿé«”
- [ ] è¨­å®šé˜²ç«ç‰†è¦å‰‡
- [ ] é…ç½®å…¥ä¾µåµæ¸¬ç³»çµ±
- [ ] è¨­å®šè‡ªå‹•å®‰å…¨æ›´æ–°
- [ ] å»ºç«‹å®‰å…¨ç›£æ§å‘Šè­¦

### æ‡‰ç”¨ç¨‹å¼å®‰å…¨
- [ ] ç§»é™¤é™¤éŒ¯å’Œé–‹ç™¼å·¥å…·
- [ ] è¨­å®šå®‰å…¨çš„ Cookie å±¬æ€§
- [ ] é…ç½® CORS æ”¿ç­–
- [ ] å¯¦ä½œ Rate Limiting
- [ ] è¨­å®šå®‰å…¨æ¨™é ­
- [ ] å•Ÿç”¨ HTTPS å¼·åˆ¶é‡å°å‘

### è³‡æ–™å®‰å…¨
- [ ] è³‡æ–™åº«é€£ç·šåŠ å¯†
- [ ] æ•æ„Ÿè³‡æ–™åŠ å¯†å„²å­˜
- [ ] å®šæœŸå‚™ä»½é©—è­‰
- [ ] å­˜å–æ—¥èªŒè¨˜éŒ„
- [ ] è³‡æ–™ä¿ç•™æ”¿ç­–å¯¦æ–½
- [ ] å€‹è³‡ä¿è­·åˆè¦æª¢æŸ¥

## ğŸ”— ç›¸é—œè³‡æº
- Docker ç”Ÿç”¢éƒ¨ç½²æœ€ä½³å¯¦å‹™
- GitHub Actions æ–‡ä»¶
- Nginx é…ç½®æŒ‡å—
- SSL/TLS é…ç½®æŒ‡å—

## ğŸ“‹ å¾ŒçºŒå·¥ä½œé …ç›®
- WI-014: ä½¿ç”¨è€…åŸ¹è¨“èˆ‡æ–‡ä»¶
- WI-015: ä¸Šç·šå¾Œç›£æ§èˆ‡ç¶­è­·

## ğŸ“ å‚™è¨»
- æ‰€æœ‰æ•æ„Ÿè³‡è¨Šéƒ½æ‡‰è©²ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–åŠ å¯†å„²å­˜
- å»ºç«‹å®Œæ•´çš„ç½é›£å¾©åŸè¨ˆåŠƒ
- å®šæœŸé€²è¡Œå®‰å…¨æ€§æª¢æŸ¥å’Œæ›´æ–°
- å»ºç«‹ä¸Šç·šå¾Œçš„ç›£æ§å’Œç¶­è­·æµç¨‹
